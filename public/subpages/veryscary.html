<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Very Scary</title>
  <style>
    /* Prevent scrolling and set body to full viewport */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: black;
    }

    /* Permanent flashing GIF overlay */
    .flash-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 2147483647;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      pointer-events: none;
      background: transparent;
    }
    .flash-overlay img {
      width: 100%;
      height: 100%;
      object-fit: cover; /* fills viewport while keeping aspect ratio */
      user-select: none;
      -webkit-user-drag: none;
      pointer-events: none;
      display: block;
      margin: 0;
    }

    /* Bouncing overlay windows */
    .scare-overlay {
      position: fixed;
      z-index: 2147483648;
      background: transparent;
      border-radius: 6px;
      overflow: visible;
      box-shadow: 0 8px 30px rgba(0,0,0,0.6);
      opacity: 0;
      transition: transform 220ms ease, opacity 220ms ease;
      pointer-events: auto;
    }
    .scare-overlay.visible {
      opacity: 1;
      transform: scale(1);
    }
    .scare-img {
      display: block;
      width: 100%;
      height: auto;
      user-select: none;
      -webkit-user-drag: none;
      pointer-events: none;
      border-radius: 6px;
    }
    .scare-close {
      position: absolute;
      top: 6px;
      right: 6px;
      background: rgba(0,0,0,0.7);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      line-height: 26px;
      font-size: 18px;
      cursor: pointer;
      z-index: 2;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0;
    }
    .scare-close:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(255,255,255,0.06);
    }
  </style>
</head>
<body>
<script>
(function () {
  const CONFIG = {
    gifPath: '/images/gif-with-window.gif',
    audioPath: '/audio/assets_idiot_1.mp3',
    initialCount: 0,
    delayedFirstSpawnDelayMs: 4000,
    maxSpeed: 324,
    minSpeed: 108,
  };

  let closeEventCount = 0;
  const overlays = new Set();

  function randomInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

  /* Permanent flashing GIF with looping audio */
  function createFlash() {
    const el = document.createElement('div');
    el.className = 'flash-overlay';

    const img = document.createElement('img');
    img.src = CONFIG.gifPath;
    img.alt = 'flashing';

    const audio = new Audio(CONFIG.audioPath);
    audio.loop = true;
    audio.volume = 1.0;
    audio.play().catch(() => {
      const resume = () => { audio.play().catch(() => {}); window.removeEventListener('pointerdown', resume); window.removeEventListener('keydown', resume); };
      window.addEventListener('pointerdown', resume, { once: true });
      window.addEventListener('keydown', resume, { once: true });
    });
    el._audio = audio;

    el.appendChild(img);
    document.body.appendChild(el);
    return el;
  }

  /* Bouncing scare windows */
  function createScare(atX, atY) {
    const el = document.createElement('div');
    el.className = 'scare-overlay';
    const width = 320 + randomInt(0, 160);
    el.style.width = width + 'px';
    const x = (typeof atX === 'number') ? atX : Math.max(10, randomInt(10, window.innerWidth - width - 10));
    const y = (typeof atY === 'number') ? atY : Math.max(10, randomInt(10, window.innerHeight - 240));
    el.style.left = x + 'px';
    el.style.top = y + 'px';
    const speed = CONFIG.minSpeed + Math.random() * (CONFIG.maxSpeed - CONFIG.minSpeed);
    const angle = Math.random() * Math.PI * 2;
    el._vx = Math.cos(angle) * speed;
    el._vy = Math.sin(angle) * speed;

    const img = document.createElement('img');
    img.src = CONFIG.gifPath;
    img.alt = 'scary';
    img.className = 'scare-img';
    img.draggable = false;

    const btn = document.createElement('button');
    btn.className = 'scare-close';
    btn.innerText = 'Ã—';
    btn.title = 'Close';

    const audio = new Audio(CONFIG.audioPath);
    audio.loop = true;
    audio.volume = 1.0;
    audio.play().catch(() => {
      const resume = () => { audio.play().catch(() => {}); window.removeEventListener('pointerdown', resume); window.removeEventListener('keydown', resume); };
      window.addEventListener('pointerdown', resume, { once: true });
      window.addEventListener('keydown', resume, { once: true });
    });
    el._audio = audio;

    btn.addEventListener('click', ev => { ev.stopPropagation(); closeScare(el); });
    el.addEventListener('click', ev => { if(ev.target!==btn) btn.click(); });

    el.appendChild(btn);
    el.appendChild(img);
    document.body.appendChild(el);
    overlays.add(el);
    requestAnimationFrame(() => el.classList.add('visible'));
    return el;
  }

  function closeScare(el) {
    if(el._audio){ el._audio.pause(); el._audio.src=''; el._audio=null; }
    if(el.parentNode) el.parentNode.removeChild(el);
    overlays.delete(el);
    closeEventCount++;
    const toSpawn = closeEventCount*2;
    for(let i=0;i<toSpawn;i++){
      const rect = el.getBoundingClientRect? el.getBoundingClientRect():null;
      const spawnX = rect? rect.left + rect.width/2 + randomInt(-60,60) : undefined;
      const spawnY = rect? rect.top + rect.height/2 + randomInt(-60,60) : undefined;
      setTimeout(()=>createScare(spawnX,spawnY),20*i+randomInt(0,160));
    }
  }

  /* Animation loop */
  let lastTs = performance.now();
  function tick(ts){
    const dt=Math.min(0.05,(ts-lastTs)/1000);
    lastTs=ts;
    const vw=window.innerWidth, vh=window.innerHeight;
    overlays.forEach(el=>{
      let nx=parseFloat(el.style.left)||0, ny=parseFloat(el.style.top)||0;
      const w=el.offsetWidth||320, h=el.offsetHeight||200;
      nx+=el._vx*dt; ny+=el._vy*dt;
      if(nx<=0){ nx=0; el._vx=Math.abs(el._vx); } 
      else if(nx+w>=vw){ nx=vw-w; el._vx=-Math.abs(el._vx); }
      if(ny<=0){ ny=0; el._vy=Math.abs(el._vy); } 
      else if(ny+h>=vh){ ny=vh-h; el._vy=-Math.abs(el._vy); }
      el.style.left=nx+'px'; el.style.top=ny+'px';
    });
    requestAnimationFrame(tick);
  }

  window.addEventListener('beforeunload', ()=>{
    overlays.forEach(el=>{ try{ if(el._audio){el._audio.pause();el._audio.src='';} }catch(e){} });
  });

  window.addEventListener('DOMContentLoaded',()=>{
    createFlash();
    requestAnimationFrame(tick);
    setTimeout(()=>createScare(),CONFIG.delayedFirstSpawnDelayMs);
  });
})();
</script>
</body>
</html>
